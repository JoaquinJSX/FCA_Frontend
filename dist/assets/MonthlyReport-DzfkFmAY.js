import{r as b,j as r}from"./index-CbNhpC_9.js";const k="_report_1toav_1",C="_no_monthlyReport_1toav_17",F="_container_1toav_41",P="_buttons_1toav_75",T="_disabledBtn_1toav_109",d={report:k,no_monthlyReport:C,container:F,buttons:P,disabledBtn:T};function B({reports:i}){const[a,g]=b.useState(i.length-1),h=a===0,p=a===i.length-1;return r.jsxs("div",{className:d.container,children:[r.jsxs("div",{className:d.buttons,children:[r.jsx("button",{onClick:()=>g(a-1),disabled:h,className:h?d.disabledBtn:"",children:"Previous"}),r.jsx("button",{onClick:()=>g(a+1),disabled:p,className:p?d.disabledBtn:"",children:"Next"})]}),r.jsx("hr",{}),r.jsxs("section",{children:[r.jsx("h1",{children:i[a].date}),r.jsx("hr",{}),r.jsx("p",{children:i[a].about_money}),r.jsx("p",{children:i[a].about_goals})]},a)]})}function K({user:i,incomes:a,setIncomes:g,expenses:h,setExpenses:p,goals:m,setGoals:j,achievedGoals:u,setAchievedGoals:$,reports:_,setReports:N}){const E=async()=>{const t=new Date,o=t.getMonth()+1,s=t.getFullYear(),e=o===1?12:o-1,n=o===1?s-1:s,y=_.some(c=>{if(!c.date)return!1;const[l,R]=c.date.split(" - "),w=parseInt(R,10);return new Date(`${l} 1, ${w}`).getMonth()+1===e&&w===n}),x=t.getDate()===1&&t.getHours()>=8,f=a.length>0||h.length>0||m.length>0||u.length>0;x&&!y&&f&&await D(e,n)};b.useEffect(()=>{E()},[i]);const D=async(t,o)=>{const s=a.reduce((c,l)=>c+l.amount,0),e=h.reduce((c,l)=>c+l.amount,0),n=m.length+u.length,y=n>0?u.length/n*100:0;if(s===0&&e===0&&m.length===0&&u.length===0){console.log("No data to report.");return}const f={date:`${new Date(o,t-1).toLocaleString("en-US",{month:"long"})} - ${o}`,about_money:`You have earned S/. ${s.toFixed(2)},  
            your biggest income source was ${Y(a)}.
            
You've spent S/. ${e.toFixed(2)},
            the area where you spent the most was ${v(h)}.`,about_goals:`You have achieved ${u.length} of ${m.length+u.length} goals,
            which represents ${y.toFixed(2)}% of your goals. ${M(y)}`};try{const c=await fetch(`https://fca-api-5k3h.onrender.com/${i.id}/monthly_report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!c.ok){const l=await c.json();alert(`Error: ${l.error}`);return}N(l=>[...l,f]),await S()}catch(c){console.error("Error adding monthly report:",c),alert("There was an error adding the monthly report. Please try again.")}},S=async()=>{try{const t=await fetch(`https://fca-api-5k3h.onrender.com/${i.id}/clear_data`,{method:"DELETE"});if(t.ok)g([]),p([]),j([]),$([]);else{const o=await t.json();alert(`Error: ${o.error}`)}}catch(t){console.error("Error clearing financial data:",t),alert("There was an error clearing financial data.")}};function Y(t){if(!t||t.length===0)return"No incomes";const o=t.reduce((e,n)=>(e[n.provenance]=(e[n.provenance]||0)+n.amount,e),{}),s=Object.keys(o).reduce((e,n)=>o[e]>o[n]?e:n);return`${s} with S/.${o[s].toFixed(2)}`}function v(t){if(!t||t.length===0)return"No expenses";const o=t.reduce((e,n)=>(e[n.purpose]=(e[n.purpose]||0)+n.amount,e),{}),s=Object.keys(o).reduce((e,n)=>o[e]>o[n]?e:n);return`${s} with S/.${o[s].toFixed(2)}`}function M(t){return t===100?"You ate the world! Congratulations!":t>=75?"You're almost there! Keep going!":t>=50?"You're halfway there! Keep going!":t>=25?"You're doing well! Keep going!":"You can do it! Don't give up!"}return r.jsx("div",{className:d.report,children:_.length===0?r.jsx("h1",{className:d.no_monthlyReport,children:"You must wait until the month ends to see your report."}):r.jsx(B,{reports:_})})}export{K as default};
